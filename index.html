<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="google" content="notranslate">
	<title>RAMP</title>

	<link rel="stylesheet" type="text/css" href="css/normalize.min.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">

	<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
	<script type="text/javascript" src="js/jsrender.min.js"></script>
	<script src="js/jquery.knob.min.js"></script>
</head>
<body>
	<header>
		<h1></h1>
	</header>

	<div id="content">
		<!-- Left Section: Track Controls -->
		<div id="track-controls" style="display:none">
			<div id="mixer-{{:num}}" class="mixer">
				<div class="v-align">
					<div class="equalizers">
						<div class="eq_low">
							<input class="knob" data-angleArc="300" data-angleOffset="-150" value="0" data-max="100" data-min="-100" data-width="35" data-height="35" data-thickness=".45" data-cursor="true" data-displayInput="false" data-bgColor="#555" data-fgColor="#3498db">
							<label>L</label>
						</div>

						<div class="eq_med">
							<input class="knob" data-angleArc="300" data-angleOffset="-150" value="0" data-max="100" data-min="-100" data-width="35" data-height="35" data-thickness=".45" data-cursor="true" data-displayInput="false" data-bgColor="#555" data-fgColor="#3498db">
							<label>M</label>
						</div>

						<div class="eq_high">
							<input class="knob" data-angleArc="300" data-angleOffset="-150" value="0" data-max="100" data-min="-100" data-width="35" data-height="35" data-thickness=".45" data-cursor="true" data-displayInput="false" data-bgColor="#555" data-fgColor="#3498db">
							<label>H</label>
						</div>
					</div>

					<div class="volume-balance">
						<div class="balance">
							<label>L</label>
							<input type="range" min="-10" max="10" value="0" name="volume">
							<label>R</label>
						</div>

						<div class="volume">
							<img src="img/vol-min.png" alt="" width="11" height="18">
							<input type="range" min="0" max="10" value="5" name="volume">
							<img src="img/vol-max.png" alt="" width="24" height="18">
						</div>
					</div>

					<div class="mute-solo">
						<button class="mute-button">M</button>
						<button class="solo-button">S</button>
					</div>
				</div> <!-- .v-align -->

				<div class="track-name"><span>{{:name}}</span></div>
			</div> <!-- .mixer -->
		</div> <!-- #track-controls-->

		<!-- Right Section: Waveforms  -->
		<div id="track-waveforms" style="display:none">
			<div id="track-{{:num}}" class="track">
				<img src="{{:waveform_path}}" class="waveform {{:~waveformStyle(num)}}" alt="">
			</div>
		</div>
	</div> <!-- .content -->

	<footer>
		<div id="master-volume">
			<img src="img/vol-min.png" alt="" width="11" height="18">
			<input type="range" min="0" max="100" value="10" id="master-volume-slider" name="master-volume-slider">
			<img src="img/vol-max.png" alt="" width="24" height="18">
		</div>

		<div id="master-play">
			<input type="image" src="img/play.png" alt="Play" data-status="paused" width="50" height="50">
		</div>

		<div id="master-scrubber" style="opacity:0">
			<label for="master-volume-slider">Scrubber:</label>
			<input type="range" min="0" max="100" value="10" id="master-volume-slider" name="master-volume-slider">
		</div>
	</footer>

	<script type="text/javascript">
		// If RAMP is being loaded from file://, fall back to the remote copy of
		// tracks.json. Chrome won't load the local copy due to security concerns.
		var trackURL;
		switch(window.location.protocol) {
			case 'http:':
			case 'https:':
				trackURL = "tracks.json";
				break;
			default:
				trackURL = "http://ramp.embercode.com/tracks.json"
				break;
		}

		// A list of the possible CSS styles for each waveform.
		var waveformStyles = [
			"wf-blue",
			"wf-green",
			"wf-yellow",
			"wf-orange",
			"wf-red",
			"wf-purple"
		];

		// Request the track information (in JSON format) from the webserver.
		// This will eventually get requested from the RAMP Server instead.
		$.getJSON(trackURL, function(trackList) {
			// Render the song title.
			var songTitle = $.templates("{{:title}}").render(trackList);
			$("h1").html(songTitle);
			document.title = "RAMP - " + songTitle;

			// Render the track controls.
			var controlsTemplate = $.templates($("#track-controls").html());
			$("#track-controls").html(
				controlsTemplate.render(trackList["tracks"])
			).css("display", "block");

			// Render the track waveforms.
			var waveformsTemplate = $.templates($("#track-waveforms").html());
			$("#track-waveforms").html(
				waveformsTemplate.render(trackList["tracks"], {
					// Assigns a different background color to each waveform.
					waveformStyle:function(num) {
						return waveformStyles[num % waveformStyles.length];
					}
				})
			).css("display", "block");

			// Render the knobs.
			$(".knob").knob({
				change : function (value) {
					//console.log("change : " + value);
				},
				release : function (value) {
					//console.log(this.$.attr('value'));
					console.log("release : " + value);
				},
				cancel : function () {
					console.log("cancel : ", this);
				},
				/*format : function (value) {
					return value + '%';
				},*/
				draw : function () {
					this.cursorExt = 0.25;

					var a = this.arc(this.cv)  // Arc
						 , pa                   // Previous arc
						 , r = 1;

					this.g.lineWidth = this.lineWidth;
				}
			});

			// Toggle mute/solo buttons when clicked.
			$(".mute-button, .solo-button").click(function() {
				var elem = $(this);
				elem.toggleClass("active");
			});
		});

		// Don't let the controls scoll vertically.
		$(window).scroll(function() {
			// We calculate this every scroll incase the user has resized the window.
			var maxHeight = $(document).height() - $(window).height();
			var scrollTop = $(document).scrollTop() || $("html, body").scrollTop();

			// Don't let the controls scoll vertically.
			// NOTE: If scrollTop is greater than maxHeight the user has scrolled
			// past the end of the page, which is why we don't move the controls.
			if (scrollTop <= maxHeight) {
				$("#track-controls").css("margin-top", "-" + scrollTop + "px");
			}
		});

		// Toggle the play/pause button when clicked.
		// NOTE: The image displays what will happen not what is happening.
		$("#master-play input").click(function() {
			var elem = $(this);

			// Swapping from Play to Pause.
			if (elem.attr("data-status") == "playing") {
				elem.attr("src", "img/play.png");
				elem.attr("data-status", "paused");
			}

			// Swapping from Pause to Play.
			else {
				elem.attr("src", "img/pause.png");
				elem.attr("data-status", "playing");
			}
		});
	</script>
</body>
</html>
